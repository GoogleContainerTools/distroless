schemaVersion: "1.0.0"
commandTests:
  - name: hello
    command: ["/usr/bin/python3", "-c", "print('Hello World')"]
    expectedOutput: ['Hello World']
  # parts of the standard library assume /bin/sh exists via os.system and subprocess.Popen
  - name: use_shell
    command: ["/usr/bin/python3", "-c",
      "import subprocess, sys; subprocess.check_call(sys.executable + ' -h', shell=True)"]
  # libraries like gunicorn and monotonic call glibc functions using ctypes
  - name: use_ctypes_glibc
    command: ["/usr/bin/python3", "-c", "import ctypes.util; ctypes.CDLL(ctypes.util.find_library('rt')).timer_create"]
    exitCode: 0

  # debian's default python3 includes a partial version of distutils causing virtualenv to fail
  # ensure we have the full version so virtualenvs work with distroless
  - name: distutils_works
    command: ["/usr/bin/python3", "-c", "import distutils.dist"]
    exitCode: 0

  # file names are UTF-8: default for modern Linux systems
  # The \xe9 backslash must be double-escaped to avoid YAML string parsing weirdness
  - name: filesystem_utf8
    command: ["/usr/bin/python3", "-c", "open(u'h\\xe9llo', 'w'); import sys; print(sys.getfilesystemencoding())"]
    expectedOutput: ['utf-8']

  # the print function should output UTF-8
  - name: print_utf8
    command: ["/usr/bin/python3", "-c", "print(u'h\\xe9llo.txt')"]
    expectedOutput: ['h\xe9llo']

  - name: imports
    command: ["/usr/bin/python3", "-c", "import abc; import aifc; import antigravity; import argparse; import ast; import asynchat; import asyncio; import asyncore; import atexit; import base64; import bdb; import binhex; import bisect; import builtins; import bz2; import cProfile; import calendar; import cgi; import cgitb; import chunk; import cmd; import code; import codecs; import codeop; import collections; import collections.abc; import colorsys; import compileall; import concurrent; import configparser; import contextlib; import copy; import copyreg; import crypt; import csv; import ctypes; import curses; import datetime; import _dbm; import dbm; import _decimal; import decimal; import difflib; import dis; import distutils; import doctest; import email; import encodings; import encodings.aliases; import encodings.latin_1; import encodings.utf_8; import enum; import errno; import filecmp; import fileinput; import fnmatch; import formatter; import fractions; import ftplib; import functools; import genericpath; import getopt; import getpass; import gettext; import glob; import gzip; import hashlib; import heapq; import hmac; import html; import http; import imaplib; import imghdr; import imp; import importlib; import inspect; import io; import ipaddress; import itertools; import json; import keyword; import linecache; import locale; import logging; import lzma; import macpath; import mailbox; import mailcap; import marshal; import mimetypes; import modulefinder; import multiprocessing; import netrc; import nntplib; import ntpath; import nturl2path; import numbers; import opcode; import operator; import optparse; import os; import os.path; import pathlib; import pdb; import pickle; import pickletools; import pipes; import pkgutil; import platform; import plistlib; import poplib; import posix; import posixpath; import pprint; import profile; import pstats; import pty; import py_compile; import pyclbr; import pydoc; import pydoc_data; import queue; import quopri; import random; import re; import readline; import reprlib; import rlcompleter; import runpy; import sched; import selectors; import shelve; import shlex; import shutil; import signal; import site; import sitecustomize; import smtpd; import smtplib; import sndhdr; import socket; import socketserver; import sqlite3; import sre_compile; import sre_constants; import sre_parse; import ssl; import stat; import statistics; import string; import stringprep; import struct; import subprocess; import sunau; import symbol; import symtable; import sys; import sysconfig; import tabnanny; import tarfile; import telnetlib; import tempfile; import test; import textwrap; import this; import threading; import timeit; import token; import tokenize; import trace; import traceback; import tracemalloc; import tty; import types; import typing; import unittest; import urllib; import uu; import uuid; import venv; import warnings; import wave; import weakref; import webbrowser; import wsgiref; import xdrlib; import xml; import xmlrpc; import zipapp; import zipfile; import zipimport"]
    exitCode: 0
